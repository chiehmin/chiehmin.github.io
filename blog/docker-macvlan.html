<!DOCTYPE html>
<html lang="en">

  <head>
      <title>FatMinMin</title>
      <link rel="shortcut icon" href="https://fatminmin.com/favicon.ico">
      <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,400,600,700' rel='stylesheet' type='text/css' />
      <link href='https://fonts.googleapis.com/css?family=Merriweather:300' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:200,400,700' rel='stylesheet' type='text/css'/>
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="https://fatminmin.com/theme/css/icons.css"/>
      <link rel="stylesheet" type="text/css" href="https://fatminmin.com/theme/css/styles.css"/>
      <link rel="stylesheet" type="text/css" href="https://fatminmin.com/theme/css/minmin_styles.css"/>
      <meta charset="utf-8" />
        <link href="/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="FatMinMin RSS Feed" />
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-7408997-8', 'auto');
        ga('send', 'pageview');

      </script>

  </head>

  <body id="index">
    <!-- header -->
    <header class="siteheader">
      <!-- site image -->
        <div class= "siteimage">
          <a class="nodec" href=/images/me.jpg>
            <img width="200" height="200" src=/images/me.jpg>
          </a>
        </div>

      <div class = "sitebanner">
        <h1><a class="sitetitle nodec" href="https://fatminmin.com">FatMinMin</a></h1>
        <h3 class ="sitesubtitle">"What doesn't kill you makes you stronger"</h3>
        <!-- nav -->
        <nav class="menu">
          <ul>
            <!-- menu items-->
              <li><a class="nodec" href="/">BLOG</a></li>
            <!--pages-->
	  		    <li><a class="nodec" href="https://fatminmin.com/pages/minminguard.html">MINMINGUARD</a></li>
	  		    <li><a class="nodec" href="https://fatminmin.com/pages/about.html">ABOUT</a></li>
            <!-- services icons -->
              <li><a class="nodec icon-github" href="https://github.com/chiehmin/"></a></li>
              <li><a class="nodec icon-facebook" href="https://www.facebook.com/fatminmin"></a></li>
              <li><a class="nodec fa fa-linkedin" href="https://tw.linkedin.com/in/fatminmin"></a></li>
              <li><a class="nodec icon-rss" href="/feeds/rss.xml"></a></li>
          </ul>
        </nav>
      </div> <!-- sitebanner -->
    </header>

    <!-- content -->

<section class="content">

  <h3 class="posttitle">
    <a class="nodec" href="/blog/docker-macvlan.html" rel="bookmark" title="Permalink to Using macvlan to create docker container with ip in host network subnet">
      Using macvlan to create docker container with ip in host network subnet
    </a>
  </h3>

  <div class="postinfo">
    <p class="published" title="2018-05-28T23:00:00+08:00">
      On 2018/05/28 at 23:00
    </p>

  </div><!-- .postinfo -->

    <div class="article">
      <p>In previous post <a href="https://fatminmin.com/blog/vm-ip-bridge-with-host.html">Create VM with ip bridge to host network (in the same network as host)</a>, I create a bridge and tap device to bridge VM network with host network. However in recent kernel update, macvlan is supported to have ethernet device virtualization. And docker has built-in support for macvlan feature.</p>
<p><a href="https://docs.docker.com/network/macvlan/">Use Macvlan network</a></p>
<p>So, I can launch containers in the same host network subnet easily and quickly.</p>
<h2 id="instructions">Instructions</h2>
<p>Create macvlan docker network. The subnet and gateway should be the same as my host network and the <code>parent</code> option should assing to the host ethernet interface.</p>
<div class="highlight"><pre><span></span>$ docker network create -d macvlan --subnet<span class="o">=</span><span class="m">10</span>.1.14.0/24 --gateway<span class="o">=</span><span class="m">10</span>.1.14.1 -o <span class="nv">parent</span><span class="o">=</span>enp5s2 macvlan
</pre></div>


<p>Launch containers with macvlan network.</p>
<div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">ti</span><span class="w"> </span><span class="c1">--network macvlan myubuntu ip addr</span>
<span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="nl">lo</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">65536</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">noqueue</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="k">UNKNOWN</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span><span class="w"></span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">loopback</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"></span>
<span class="w">    </span><span class="n">inet</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="o">/</span><span class="mi">8</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">lo</span><span class="w"></span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"></span>
<span class="w">    </span><span class="n">inet6</span><span class="w"> </span><span class="o">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="k">host</span><span class="w"></span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"></span>
<span class="mi">19</span><span class="err">:</span><span class="w"> </span><span class="n">eth0</span><span class="nv">@if3</span><span class="err">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">noqueue</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"></span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="mi">02</span><span class="err">:</span><span class="mi">42</span><span class="err">:</span><span class="mi">0</span><span class="nl">a</span><span class="p">:</span><span class="mi">01</span><span class="err">:</span><span class="mi">0</span><span class="nl">e</span><span class="p">:</span><span class="mi">02</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span><span class="w"> </span><span class="n">link</span><span class="o">-</span><span class="n">netnsid</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">inet</span><span class="w"> </span><span class="mf">10.1.14.2</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">eth0</span><span class="w"></span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"></span>
<span class="w">    </span><span class="n">inet6</span><span class="w"> </span><span class="nl">fe80</span><span class="p">:</span><span class="err">:</span><span class="mi">42</span><span class="err">:</span><span class="nl">aff</span><span class="p">:</span><span class="nl">fe01</span><span class="p">:</span><span class="n">e02</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">tentative</span><span class="w"></span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"></span>
</pre></div>
    </div><!-- .content -->

    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
       var disqus_shortname = 'fatminmin';
       var disqus_identifier = 'blog/docker-macvlan.html';
       var disqus_url = 'https://fatminmin.com/blog/docker-macvlan.html';
       (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] ||
             document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>

</section>


    <!-- footer -->
    <footer>
      <p>
        © FatMinMin, license <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"> CC BY-NC-SA 4.0</a>
        unless otherwise noted.
        Generated by <a href= "http://docs.getpelican.com/">Pelican</a> with
        <a href="https://github.com/chiehmin/crowsfoot">crowsfoot</a> theme.
      </p>
    </footer>
  </body>
</html>